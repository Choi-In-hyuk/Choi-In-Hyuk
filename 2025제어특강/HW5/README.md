코드가 하는 역할
이 코드는 **MPC (Model Predictive Control, 모델 예측 제어)**를 사용하여 로봇의 상태를 조정하는 제어 알고리즘을 구현한 것입니다.
로봇이 특정 초기 상태에서 출발하여 원하는 목표 상태로 이동하도록 최적의 제어 입력을 계산하는 방식입니다.

1. 코드의 제어 대상 (로봇 시스템)
이 코드에서 제어하려는 시스템은 3개의 상태 변수 
𝑥
1
,
𝑥
2
,
𝑥
3
x 
1
​
 ,x 
2
​
 ,x 
3
​
 를 가지는 로봇입니다.
로봇의 상태는 다음과 같이 정의할 수 있습니다:

𝑥
=
[
𝑥
1
𝑥
2
𝑥
3
]
x= 
​
  
x 
1
​
 
x 
2
​
 
x 
3
​
 
​
  
​
 
상태 변수 
𝑥
1
,
𝑥
2
,
𝑥
3
x 
1
​
 ,x 
2
​
 ,x 
3
​
 :

로봇의 위치 또는 속도와 관련된 값일 가능성이 큼.
실제로는 특정 물리 시스템(예: 2D 이동 로봇 또는 유사한 동역학을 가진 시스템)의 상태를 나타냄.
제어 입력 
𝑢
1
,
𝑢
2
u 
1
​
 ,u 
2
​
 :

𝑢
1
u 
1
​
 : 주 제어 입력 (예: 전진 속도 조절)
𝑢
2
u 
2
​
 : 추가적인 보조 입력 (예: 회전 또는 가속 조절)
이 입력들을 통해 로봇의 상태를 변화시킴.
2. MPC의 동작 방식
(1) 동역학 모델
로봇의 움직임은 선형 상태방정식을 따릅니다.

𝑥
𝑘
+
1
=
𝐴
𝑥
𝑘
+
𝐵
𝑢
𝑘
x 
k+1
​
 =Ax 
k
​
 +Bu 
k
​
 
여기서:

𝐴
A: 시스템의 상태 행렬 (로봇의 기본적인 물리 모델을 나타냄)
𝐵
B: 입력 행렬 (제어 입력이 상태에 어떻게 영향을 주는지를 나타냄)
𝑢
𝑘
u 
k
​
 : 현재 시점에서의 제어 입력
코드에서 정의된 
𝐴
A와 
𝐵
B는 다음과 같습니다:

𝐴
=
[
0
𝑤
𝑟
0
−
𝑤
𝑟
0
𝑣
𝑟
0
0
0
]
A= 
​
  
0
−w 
r
​
 
0
​
  
w 
r
​
 
0
0
​
  
0
v 
r
​
 
0
​
  
​
 
𝐵
=
[
−
1
0
0
0
0
−
1
]
B= 
​
  
−1
0
0
​
  
0
0
−1
​
  
​
 
이는 특정한 이동 로봇(또는 유사한 동역학을 가진 시스템)의 모델을 기반으로 함.

(2) 최적화 문제 설정
MPC는 미래의 일정한 시간 구간 (
𝑁
N 스텝) 동안의 제어 입력을 최적화하는 방식으로 동작합니다.

목적 함수:
𝐽
=
∑
𝑘
=
1
𝑁
(
𝑥
𝑘
𝑇
𝑄
𝑥
𝑘
+
𝑢
𝑘
𝑇
𝑅
𝑢
𝑘
)
J= 
k=1
∑
N
​
 (x 
k
T
​
 Qx 
k
​
 +u 
k
T
​
 Ru 
k
​
 )
𝑄
Q: 상태 오차를 최소화하는 행렬 (상태가 목표에 가까워지도록 함)

𝑅
R: 제어 입력을 최소화하는 행렬 (입력이 과도하지 않도록 함)

𝑁
N: 예측 구간 (즉, 미래 
𝑁
N 개의 스텝 동안 미리 최적의 입력을 찾음)

제약 조건:

입력의 범위 제한: 
𝑢
1
u 
1
​
 과 
𝑢
2
u 
2
​
 는 최대/최소 값이 있음.
상태의 범위 제한: 
𝑥
x가 특정 범위를 벗어나지 않도록 설정.
(3) 최적화 수행
MPC는 미래 
𝑁
N 단계 동안의 최적 제어 입력 
𝑢
u를 예측하고, 첫 번째 입력 
𝑢
1
u 
1
​
 만 실행하는 방식입니다. 즉:

현재 상태를 기반으로 최적화 문제를 해결하여 
𝑁
N 개의 입력 시퀀스를 계산
첫 번째 입력 
𝑢
1
u 
1
​
 만 적용
다음 시간 스텝에서 다시 최적화를 수행 (이 과정 반복)
이를 통해 환경 변화에도 유연하게 대응할 수 있습니다.

3. MPC와 LQR의 차이점
MPC와 LQR (Linear Quadratic Regulator)은 모두 최적 제어 방법이지만, 근본적인 동작 방식이 다릅니다.

비교 항목	MPC (Model Predictive Control)	LQR (Linear Quadratic Regulator)
기본 원리	미래 일정 구간의 입력을 최적화하여 계산하고, 첫 번째 입력만 실행	한 번의 계산으로 전체 제어 법칙(상태 피드백)을 결정
제약 조건	입력과 상태의 제약 조건을 포함할 수 있음	일반적으로 제약 조건을 포함할 수 없음
계산 비용	매번 최적화 문제를 풀어야 하므로 계산량이 많음	한 번 계산 후, 피드백 법칙만 적용하므로 계산량이 적음
환경 변화 대응	실시간으로 상태를 고려하여 최적의 입력을 결정 (적응적)	환경이 변하면 설계된 게인 값을 다시 계산해야 함
적용 사례	로봇, 자율 주행, 공정 제어 등 제약이 중요한 시스템	전통적인 제어 시스템 (항공기, 로봇 암, 전력 시스템 등)
MPC vs LQR 예제
LQR은 주어진 시스템에서 최적의 상태 피드백 게인 
𝐾
K를 한 번 계산하면 끝입니다.
제어 법칙: 
𝑢
=
−
𝐾
𝑥
u=−Kx
예측 구간 개념이 없음.
MPC는 매 순간 최적화를 수행하여 실시간으로 최적 입력을 찾음.
예측 구간 
𝑁
N을 기반으로 미래를 고려하여 입력을 결정.
제약 조건을 포함할 수 있어 현실적인 제어 적용이 가능.
4. 이 코드에서의 적용 방식
이 코드는 MPC 방식으로 로봇을 제어하는 예제이며, LQR과 달리 입력의 제약 조건을 포함하고 있음.
즉:

LQR로 제어하면 입력 제한을 고려하지 못해 비현실적인 값이 나올 가능성이 있음.
MPC는 입력과 상태의 제한을 명시적으로 고려하여 최적 제어를 수행함.
5. 결론
이 코드는 MPC를 사용하여 로봇의 상태를 원하는 목표 상태로 이동시키는 역할을 수행.
LQR은 단순한 선형 제어지만, MPC는 입력 제약 조건을 포함하고 실시간으로 최적화 가능.
MPC는 계산량이 많지만, 현실적인 제어 문제(로봇, 자율주행 등)에 적합.
👉 제약 조건이 중요한 환경에서는 LQR보다 MPC가 더 강력한 방법입니다! 
